<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0B0E14">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Brendimo Premium | Loyallƒ±q</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- RESET & VARIABLES --- */
        :root {
            /* Palette: Deep Midnight & Electric Aurora */
            --bg-body: #0B0E14;
            --bg-surface: #151921;
            --bg-card: #1E232F;
            
            --text-main: #FFFFFF;
            --text-muted: #94A3B8;
            
            /* Gradients */
            --primary-grad: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
            --gold-grad: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
            --success-grad: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            
            --accent-color: #8b5cf6;
            --accent-glow: 0 0 25px rgba(139, 92, 246, 0.3);
            
            --border-light: rgba(255, 255, 255, 0.08);
            
            --radius-sm: 12px;
            --radius-md: 18px;
            --radius-lg: 28px;
            
            --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Ambient Background Glows */
        body::before {
            content: ""; position: fixed; top: -20%; left: -20%; width: 60%; height: 60%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.15), transparent 70%);
            filter: blur(80px); pointer-events: none; z-index: -1;
        }
        body::after {
            content: ""; position: fixed; bottom: -10%; right: -10%; width: 60%; height: 60%;
            background: radial-gradient(circle, rgba(217, 70, 239, 0.1), transparent 70%);
            filter: blur(80px); pointer-events: none; z-index: -1;
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(15px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in { animation: fadeSlideUp 0.5s var(--ease-smooth) forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }

        /* --- UI COMPONENTS --- */
        .hidden { display: none !important; }

        .btn-primary {
            width: 100%; padding: 18px;
            background: var(--primary-grad);
            color: #fff; border: none;
            border-radius: var(--radius-md);
            font-size: 16px; font-weight: 700;
            cursor: pointer; position: relative; overflow: hidden;
            box-shadow: 0 8px 20px -5px rgba(139, 92, 246, 0.4);
            transition: transform 0.2s, background 0.3s;
        }
        .btn-primary:active { transform: scale(0.97); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; filter: grayscale(1); }
        
        .btn-sm {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-light);
            border-radius: 50px;
            color: #fff; font-size: 12px; font-weight: 600;
            cursor: pointer;
        }

        .input-group { position: relative; margin-bottom: 20px; }
        .input-field {
            width: 100%; padding: 22px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            color: #fff; font-size: 16px;
            transition: 0.3s;
        }
        .input-field:focus { 
            border-color: var(--accent-color); 
            background: rgba(139, 92, 246, 0.05); 
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        /* --- AUTH SCREEN --- */
        #auth-screen {
            position: fixed; inset: 0; z-index: 2000;
            background: var(--bg-body);
            display: flex; flex-direction: column; justify-content: center;
            padding: 30px;
        }
        .brand-logo {
            font-size: 42px; font-weight: 800; letter-spacing: -1.5px;
            text-align: center; margin-bottom: 8px;
            background: var(--primary-grad);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .auth-sub { text-align: center; color: var(--text-muted); margin-bottom: 40px; font-size: 15px; }

        /* --- MAIN CONTAINER --- */
        .container {
            max-width: 480px; margin: 0 auto;
            padding: 20px 20px 140px 20px;
            min-height: 100vh;
        }

        /* HEADER */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-top: 10px; }
        .user-welcome { font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--accent-color); margin-bottom: 4px; letter-spacing: 1px; }
        .user-name { font-size: 24px; font-weight: 700; color: #fff; letter-spacing: -0.5px; }
        .avatar {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; color: #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* HOLOGRAPHIC WALLET CARD */
        .wallet-card {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
            padding: 24px; position: relative; overflow: hidden;
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.6);
            margin-bottom: 32px;
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 180px;
        }
        .wallet-card::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.3) 0, transparent 50%), 
                        radial-gradient(at 100% 100%, rgba(217, 70, 239, 0.3) 0, transparent 50%);
            animation: rotateMesh 10s linear infinite; opacity: 0.6;
        }
        @keyframes rotateMesh { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .card-top { position: relative; z-index: 2; display: flex; justify-content: space-between; align-items: flex-start; }
        .card-chip { width: 40px; height: 28px; background: rgba(255,255,255,0.1); border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); }
        .balance-group { position: relative; z-index: 2; margin-top: auto; }
        .balance-label { font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 4px; }
        .balance-amount { font-size: 44px; font-weight: 800; color: #fff; letter-spacing: -1px; text-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .balance-amount span { font-size: 18px; font-weight: 500; opacity: 0.8; margin-left: 4px; }

        /* --- SECTION TITLES & FILTERS --- */
        .section-header { 
            margin-bottom: 16px; margin-top: 10px; padding: 0 4px; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .section-title { font-size: 18px; font-weight: 700; color: #fff; display: flex; align-items: center; gap: 8px; }
        .section-title::before { content:''; width:4px; height:18px; background: var(--primary-grad); border-radius: 4px; }
        
        .sort-select {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-muted);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-family: inherit;
        }

        /* --- DAILY CHECK-IN --- */
        .daily-checkin-wrapper {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 20px;
            border: 1px solid var(--border-light);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .daily-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .streak-count { font-weight: 700; color: #fbbf24; display: flex; align-items: center; gap: 6px; }

        .days-row {
            display: flex; justify-content: space-between; align-items: center;
            position: relative;
        }
        .days-row::before {
            content: ''; position: absolute; top: 50%; left: 10px; right: 10px; height: 4px;
            background: rgba(255,255,255,0.05); border-radius: 4px; z-index: 0; transform: translateY(-50%);
        }
        
        .day-item {
            position: relative; z-index: 1;
            width: 40px; height: 40px;
            border-radius: 12px;
            background: #2D3342;
            border: 2px solid transparent;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 700; color: var(--text-muted);
            transition: all 0.3s var(--ease-bounce);
        }
        .day-item.claimed {
            background: #10B981; color: #fff;
            border-color: #10B981;
        }
        .day-item.active {
            background: var(--bg-card);
            border-color: var(--accent-color);
            color: #fff;
            transform: scale(1.15);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
            cursor: pointer;
            animation: pulseGlow 2s infinite;
        }
        .day-item.locked { opacity: 0.5; }
        
        .day-val { font-size: 10px; margin-top: -2px; }

        .checkin-btn {
            margin-top: 20px;
            width: 100%; padding: 12px;
            border-radius: 14px; border: none;
            background: var(--bg-surface);
            color: var(--text-muted); font-weight: 600;
            pointer-events: none;
        }
        .checkin-btn.ready {
            background: var(--primary-grad);
            color: #fff; pointer-events: auto; cursor: pointer;
        }

        /* --- REDESIGNED MISSIONS & STATUS --- */
        #missions-list { display: grid; gap: 16px; }
        
        .mission-card {
            background: rgba(30, 35, 47, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-light);
            border-radius: 24px;
            padding: 0;
            display: flex; flex-direction: column;
            position: relative; overflow: hidden;
            transition: transform 0.2s;
        }
        .mission-card:active { transform: scale(0.98); }
        
        .m-card-top {
            padding: 20px;
            display: flex; align-items: center; gap: 16px;
            position: relative; z-index: 2;
        }
        .m-icon {
            width: 50px; height: 50px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .m-content { flex: 1; }
        .m-title { font-weight: 700; font-size: 16px; color: #fff; margin-bottom: 4px; }
        .m-desc { font-size: 12px; color: var(--text-muted); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;}
        
        .m-card-bottom {
            padding: 12px 20px;
            background: rgba(0,0,0,0.2);
            display: flex; justify-content: space-between; align-items: center;
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        
        .xp-pill {
            padding: 6px 12px;
            background: rgba(139, 92, 246, 0.15);
            border-radius: 8px;
            color: #c4b5fd; font-size: 12px; font-weight: 800;
            display: flex; align-items: center; gap: 4px;
        }
        
        /* Status Badges */
        .status-badge {
            font-size: 11px; font-weight: 700;
            padding: 4px 10px; border-radius: 20px;
            display: flex; align-items: center; gap: 4px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .status-badge.new { background: rgba(255,255,255,0.1); color: #fff; }
        .status-badge.done { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .status-badge.pending { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }

        /* --- LEADERBOARD --- */
        .leaderboard-list {
            display: flex; flex-direction: column; gap: 10px;
        }
        .rank-item {
            display: flex; align-items: center;
            background: rgba(255,255,255,0.03);
            padding: 14px; border-radius: 16px;
            border: 1px solid var(--border-light);
        }
        .rank-num {
            width: 30px; font-weight: 800; font-size: 16px; color: var(--text-muted); text-align: center;
        }
        .rank-item:nth-child(1) .rank-num { color: #fbbf24; font-size: 20px; text-shadow: 0 0 10px rgba(251, 191, 36, 0.4); }
        .rank-item:nth-child(2) .rank-num { color: #94a3b8; }
        .rank-item:nth-child(3) .rank-num { color: #b45309; }
        
        .rank-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: #2D3342; margin: 0 12px;
            display: flex; align-items: center; justify-content: center; font-weight: 700;
        }
        .rank-info { flex: 1; }
        .rank-name { font-weight: 700; font-size: 14px; }
        .rank-xp { font-weight: 600; color: var(--accent-color); font-size: 13px; }

        .rank-item.is-me {
            background: rgba(139, 92, 246, 0.1);
            border-color: var(--accent-color);
        }

        /* --- EMPTY STATES --- */
        .empty-state {
            text-align: center; padding: 40px 20px;
            color: var(--text-muted); font-size: 14px;
            background: rgba(255,255,255,0.02);
            border: 1px dashed rgba(255,255,255,0.1); 
            border-radius: var(--radius-md);
        }

        /* --- NAVIGATION --- */
        .nav-bar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 100px;
            display: flex; justify-content: space-around; align-items: center;
            padding: 12px; z-index: 1000;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            padding-bottom: max(12px, env(safe-area-inset-bottom));
        }
        .nav-btn {
            background: none; border: none; padding: 10px;
            color: #64748b; transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative;
        }
        .nav-btn svg { width: 24px; height: 24px; fill: currentColor; margin-bottom: 0; transition: 0.3s; }
        
        .nav-btn.active { color: #fff; }
        .nav-btn.active svg { transform: translateY(-3px); filter: drop-shadow(0 0 8px var(--accent-color)); }
        .nav-btn.active::after {
            content: ''; position: absolute; bottom: 0; width: 4px; height: 4px;
            background: var(--accent-color); border-radius: 50%;
            box-shadow: 0 0 8px var(--accent-color);
        }

        /* --- MODAL & UPLOAD --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 3000; display: none; align-items: flex-end; justify-content: center;
        }
        .modal-box {
            background: #111827;
            width: 100%; max-width: 500px;
            border-radius: 30px 30px 0 0;
            padding: 30px; border-top: 1px solid rgba(255,255,255,0.1);
            position: relative; animation: fadeSlideUp 0.4s var(--ease-bounce);
            padding-bottom: max(30px, env(safe-area-inset-bottom));
            box-shadow: 0 -10px 50px rgba(0,0,0,0.7);
        }
        .modal-emoji { font-size: 60px; margin-bottom: 10px; display: inline-block; filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.4)); }
        .modal-title { font-size: 22px; font-weight: 800; color: #fff; margin-bottom: 5px; }
        .modal-reward { font-size: 18px; color: var(--accent-color); font-weight: 700; margin-bottom: 20px; }
        .modal-desc-box { 
            text-align: left; background: rgba(255,255,255,0.03); 
            padding: 20px; border-radius: 16px; margin: 20px 0; border: 1px solid rgba(255,255,255,0.05);
        }
        .modal-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
        .modal-text { font-size: 14px; line-height: 1.6; color: #e2e8f0; margin-bottom: 15px; }

        /* UPLOAD STYLES */
        .upload-area {
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            background: rgba(255,255,255,0.02);
            margin-bottom: 15px;
        }
        .upload-area:hover { border-color: var(--accent-color); background: rgba(139, 92, 246, 0.05); }
        .upload-icon { font-size: 32px; margin-bottom: 8px; color: var(--text-muted); }
        .upload-text { font-size: 14px; color: #fff; font-weight: 600; }
        .upload-sub { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
        
        .file-selected {
            display: flex; align-items: center; gap: 10px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            padding: 10px; border-radius: 12px;
            margin-bottom: 15px; color: #fff; font-size: 13px;
        }
        
        /* SPINNER */
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }

    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="brand-logo">Brendimo<span style="color:#fff">.</span></div>
        <div class="auth-sub">Premium M√º≈üt…ôri Loyallƒ±q Klubu</div>
        
        <div class="input-group">
            <input type="text" id="reg-name" class="input-field" placeholder="Ad v…ô Soyad">
        </div>
        <div class="input-group">
            <input type="tel" id="reg-phone" class="input-field" placeholder="Mobil N√∂mr…ô (m…ôs: 0505554433)">
        </div>
        
        <button class="btn-primary" id="btn-login" onclick="App.handleLogin()">KLUBUNA QO≈ûUL</button>
        <p id="login-error" style="color: #ef4444; text-align: center; font-size: 13px; margin-top: 20px;" class="hidden"></p>
    </div>

    <div id="app-container" class="container hidden">
        
        <div class="header-row fade-in delay-1">
            <div>
                <div class="user-welcome">Xo≈ü g…ôldin</div>
                <div class="user-name" id="u-name">H√∂rm…ôtli M√º≈üt…ôri</div>
            </div>
            <div class="avatar" id="u-avatar">B</div>
        </div>

        <div class="wallet-card fade-in delay-2">
            <div class="card-top">
                <div class="card-chip"></div>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="rgba(255,255,255,0.5)"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
            </div>
            <div class="balance-group">
                <div class="balance-label">√úMUMI BALANS</div>
                <div class="balance-amount" id="u-coins">0<span>XP</span></div>
            </div>
        </div>

        <div id="view-home" class="view-section fade-in delay-3">
            
            <div class="section-header">
                <div class="section-title">G√ºnd…ôlik Bonus</div>
                <div class="streak-count">üî• <span id="streak-display">0 G√ºn</span></div>
            </div>
            
            <div class="daily-checkin-wrapper" id="daily-module">
                <div class="daily-header">
                    <span style="font-size:12px; color:var(--text-muted);">H…ôr g√ºn daxil ol, qazan!</span>
                </div>
                <div class="days-row" id="streak-days">
                </div>
                <button id="btn-checkin" class="checkin-btn" onclick="Daily.checkIn()">G√ñZL∆èYƒ∞N...</button>
            </div>

            <div class="section-header">
                <div class="section-title">Tap≈üƒ±rƒ±qlar</div>
                <select id="mission-sort" class="sort-select" onchange="UI.renderMissions()">
                    <option value="new">∆èn Yenil…ôr</option>
                    <option value="high">√áox XP</option>
                </select>
            </div>
            
            <div id="missions-list">
                <div class="empty-state">Y√ºkl…ônir...</div>
            </div>
        </div>

        <div id="view-leaderboard" class="view-section hidden fade-in">
            <div class="section-header">
                <div class="section-title">Liderl…ôr C…ôdv…ôli</div>
                <span style="font-size:12px; color:var(--accent-color)">TOP 20</span>
            </div>
            <div style="background:var(--primary-grad); border-radius:16px; padding:20px; margin-bottom:20px; text-align:center;">
                <div style="font-size:12px; color:rgba(255,255,255,0.8);">Sƒ∞Zƒ∞N SIRALAMANIZ</div>
                <div style="font-size:32px; font-weight:800; margin:5px 0;">#<span id="my-rank">--</span></div>
                <div style="font-size:12px; opacity:0.8;">B√ºt√ºn Brendimo √ºzvl…ôri arasƒ±nda</div>
            </div>
            <div id="leaderboard-list" class="leaderboard-list">
            </div>
        </div>

        <div id="view-shop" class="view-section hidden fade-in">
            <div class="section-header"><div class="section-title">Kuponlarƒ±m</div></div>
            <div id="inventory-list" class="empty-state">Hen√ºz kuponunuz yoxdur.</div>
            
            <div class="section-header" style="margin-top: 30px;"><div class="section-title">Kataloq</div></div>
            <div id="shop-list" class="empty-state">M…ôhsullar tezlikl…ô...</div>
        </div>

        <div id="view-history" class="view-section hidden fade-in">
            <div class="section-header"><div class="section-title">Tarix√ß…ô</div></div>
            <div id="history-list"></div>
            <button class="btn-primary" style="margin-top: 40px; background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); box-shadow:none;" onclick="App.logout()">√áIXI≈û ET</button>
        </div>

    </div>

    <nav class="nav-bar hidden" id="main-nav">
        <button class="nav-btn active" onclick="App.nav('home', this)">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        </button>
        <button class="nav-btn" onclick="App.nav('leaderboard', this)">
             <svg viewBox="0 0 24 24"><path d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z"/></svg>
        </button>
        <button class="nav-btn" onclick="App.nav('shop', this)">
            <svg viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2-2v2H4c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm-8-2h4v2h-4V4z"/></svg>
        </button>
        <button class="nav-btn" onclick="App.nav('history', this)">
            <svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.53.85-1.07-3.13-1.86V8h-2z"/></svg>
        </button>
    </nav>

  
    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <div style="width:40px; height:4px; background:rgba(255,255,255,0.1); margin:0 auto 20px auto; border-radius:2px;"></div>
            <div style="position:absolute; top:20px; right:20px; color:#fff; font-size:24px; cursor:pointer;" onclick="UI.closeModal()">√ó</div>
            <div id="modal-body"></div>
        </div>
    </div>

    <input type="file" id="file-input" hidden accept="image/*,.pdf">

    <script>
        // --- CONFIG ---
        const API_URL = 'https://script.google.com/macros/s/AKfycbyme_ho75RSgc_5P3Pg7CNfTgsesdPMxgR5ric4coFzCAlM5RZhDvP8_AppagsQlHmP/exec';

        const Store = {
            data: {
                name: '', phone: '', coins: 0, 
                inventory: [], history: [], 
                completedTasks: [], // IDs of approved/auto-complete tasks
                pendingTasks: [],   // IDs of tasks "Under Review"
                lastCheckIn: '', streak: 0
            },
            missions: [],
            
            save() { 
                localStorage.setItem('brendimo_v11_pro', JSON.stringify(this.data)); 
                this.sync();
            },
            
            load() {
                const local = localStorage.getItem('brendimo_v11_pro');
                if(local) {
                    const parsed = JSON.parse(local);
                    // Ensure pendingTasks exists (migration support)
                    if(!parsed.pendingTasks) parsed.pendingTasks = [];
                    this.data = { ...this.data, ...parsed };
                }
                return !!this.data.phone;
            },

            async sync() {
                try {
                    fetch(API_URL, {
                        method: 'POST',
                        body: JSON.stringify({ action: 'sync', data: this.data }),
                        keepalive: true
                    });
                } catch(e) {}
                UI.render();
            }
        };

        const App = {
            async handleLogin() {
                const name = document.getElementById('reg-name').value.trim();
                const phone = document.getElementById('reg-phone').value.trim().replace(/[^0-9]/g, '');
                const btn = document.getElementById('btn-login');
                const err = document.getElementById('login-error');

                if(name.length < 3 || phone.length < 9) {
                    err.innerText = "M…ôlumatlarƒ± d√ºzg√ºn daxil edin.";
                    err.classList.remove('hidden');
                    return;
                }

                btn.disabled = true;
                btn.innerHTML = `Yoxlanƒ±lƒ±r...`; 

                try {
                    const res = await fetch(`${API_URL}?action=login&phone=${phone}&name=${encodeURIComponent(name)}`);
                    const json = await res.json();

                    if(json.status === 'success') {
                        Store.data = { ...Store.data, ...json.data };
                        // Ensure pending tasks is initialized
                        if(!Store.data.pendingTasks) Store.data.pendingTasks = [];
                        
                        Store.missions = json.missions || [];
                        Store.save();
                        this.initMain();
                    }
                } catch(e) {
                    err.innerText = "Server x…ôtasƒ±. ƒ∞nterneti yoxlayƒ±n.";
                    err.classList.remove('hidden');
                    btn.disabled = false;
                    btn.innerText = "KLUBUNA QO≈ûUL";
                }
            },

            initMain() {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                
                const firstName = Store.data.name.split(' ')[0];
                document.getElementById('u-name').innerText = Store.data.name;
                document.getElementById('u-avatar').innerText = firstName.charAt(0).toUpperCase();
                
                UI.render();
                Daily.init();
            },

            nav(view, el) {
                document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
                const newView = document.getElementById(`view-${view}`);
                newView.classList.remove('hidden');
                newView.classList.add('fade-in');
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                el.classList.add('active');
                window.scrollTo(0,0);

                if(view === 'leaderboard') Leaderboard.render();
            },

            logout() {
                if(confirm("√áƒ±xmaq ist…ôyirsiniz?")) {
                    localStorage.clear();
                    location.reload();
                }
            }
        };

        const UI = {
            render() {
                document.getElementById('u-coins').innerHTML = `${Store.data.coins}<span>XP</span>`;
                this.renderMissions();
                
                // History
                const hList = document.getElementById('history-list');
                hList.innerHTML = Store.data.history.length ? Store.data.history.map((h, index) => `
                    <div class="mission-card fade-in" style="animation-delay: ${index * 0.05}s; padding:12px; flex-direction:row; align-items:center; margin-bottom:10px;">
                        <div class="m-content">
                            <div class="m-title" style="font-size:14px; margin-bottom:2px;">${h.desc}</div>
                            <div style="font-size:11px; color:var(--text-muted);">${h.date}</div>
                        </div>
                        <div style="font-weight:700; color:${h.amount.includes('+') ? '#4ade80' : '#fff'}">${h.amount}</div>
                    </div>
                `).join('') : '<div class="empty-state">Tarix√ß…ô bo≈üdur.</div>';
            },

            renderMissions() {
                const mList = document.getElementById('missions-list');
                const sortType = document.getElementById('mission-sort').value;
                
                let sortedMissions = [...Store.missions];
                
                if(sortType === 'high') {
                    sortedMissions.sort((a,b) => b.points - a.points);
                } else {
                    sortedMissions.reverse();
                }

                if(sortedMissions.length === 0) {
                    mList.innerHTML = `<div class="empty-state">Hal-hazƒ±rda aktiv missiya yoxdur.</div>`;
                } else {
                    mList.innerHTML = sortedMissions.map((m, index) => {
                        // Check Status
                        const isDone = Store.data.completedTasks.includes(m.id);
                        const isPending = Store.data.pendingTasks.includes(m.id);
                        
                        let badgeHtml = '';
                        let icon = '‚ö°';
                        
                        if (isDone) {
                            badgeHtml = '<div class="status-badge done">‚úî Tamamlandƒ±</div>';
                            icon = '‚úÖ';
                        } else if (isPending) {
                            badgeHtml = '<div class="status-badge pending">‚è≥ Yoxlanƒ±lƒ±r</div>';
                            icon = 'üìÇ';
                        } else {
                            badgeHtml = '<div class="status-badge new">Yeni</div>';
                        }
                        
                        return `
                        <div class="mission-card fade-in" style="animation-delay: ${index * 0.1}s" onclick="UI.openMission('${m.id}')">
                            <div class="m-card-top">
                                <div class="m-icon">${icon}</div>
                                <div class="m-content">
                                    <div class="m-title">${m.title}</div>
                                    <div class="m-desc">${m.desc.substring(0, 60)}...</div>
                                </div>
                            </div>
                            <div class="m-card-bottom">
                                <div class="xp-pill">
                                    <span>üíé</span> ${m.points} XP
                                </div>
                                ${badgeHtml}
                            </div>
                        </div>`;
                    }).join('');
                }
            },

            openMission(id) {
                const m = Store.missions.find(x => x.id === id);
                if(!m) return;
                
                const isDone = Store.data.completedTasks.includes(id);
                const isPending = Store.data.pendingTasks.includes(id);
                
                let html = `
                    <div class="modal-emoji">üöÄ</div>
                    <h2 class="modal-title">${m.title}</h2>
                    <div class="modal-reward">+${m.points} XP Qazan</div>
                    
                    <div class="modal-desc-box">
                        <div class="modal-label">TAP≈ûIRIQ</div>
                        <div class="modal-text">${m.desc}</div>
                        
                        <div class="modal-label">ADDIMLAR</div>
                        <div class="modal-text" style="white-space:pre-line">${m.steps}</div>
                    </div>
                `;

                if(isDone) {
                    html += `<button class="btn-primary" style="background:#222; color:#555;" disabled>ARTIQ TAMAMLANIB</button>`;
                } else if (isPending) {
                    html += `
                        <div style="text-align:center; padding:15px; background:rgba(245, 158, 11, 0.1); border-radius:12px; border:1px solid rgba(245, 158, 11, 0.3); margin-bottom:15px;">
                            <div style="font-weight:700; color:#fbbf24;">üîç YOXLANILIR</div>
                            <div style="font-size:12px; color:rgba(255,255,255,0.7); margin-top:5px;">S√ºbut g√∂nd…ôrilib. Admin t…ôsdiqind…ôn sonra balans artacaq.</div>
                        </div>
                        <button class="btn-primary" onclick="UI.closeModal()">BAƒûLA</button>
                    `;
                } else {
                    // NEW: Upload Form
                    html += `
                        <div id="upload-container">
                             <div class="upload-area" onclick="document.getElementById('file-input').click()">
                                <div class="upload-icon">üìé</div>
                                <div class="upload-text">S√ºbut y√ºkl…ô</div>
                                <div class="upload-sub">Screenshot v…ô ya PDF</div>
                            </div>
                            <div id="file-preview" class="hidden"></div>
                        </div>
                        <button id="btn-submit-task" class="btn-primary" onclick="UI.submitProof('${m.id}')" disabled>T∆èSDƒ∞QL∆è V∆è QAZAN</button>
                    `;
                }

                this.openModal(html);

                // Attach File Listener if not done/pending
                if(!isDone && !isPending) {
                    const fileInput = document.getElementById('file-input');
                    fileInput.value = ''; // Reset
                    fileInput.onchange = (e) => {
                        const file = e.target.files[0];
                        if(file) {
                            const preview = document.getElementById('file-preview');
                            preview.innerHTML = `<div class="file-selected">üìÑ ${file.name} (${(file.size/1024).toFixed(1)} KB)</div>`;
                            preview.classList.remove('hidden');
                            document.querySelector('.upload-area').style.borderColor = '#10B981';
                            document.getElementById('btn-submit-task').disabled = false;
                        }
                    };
                }
            },

            submitProof(missionId) {
                const fileInput = document.getElementById('file-input');
                const file = fileInput.files[0];
                if(!file) return alert("Z…ôhm…ôt olmasa s√ºbut y√ºkl…ôyin.");

                const btn = document.getElementById('btn-submit-task');
                btn.disabled = true;
                btn.innerHTML = `<span class="spinner"></span> Y√ºkl…ônir...`;

                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async function() {
                    const base64Data = reader.result.split(',')[1]; // Remove header
                    // Clean Mission Title for filename
                    const missionTitle = Store.missions.find(m=>m.id === missionId).title.replace(/[^a-zA-Z0-9]/g, "_");
                    const newFileName = `${Store.data.phone}_${missionTitle}_${Date.now()}.${file.name.split('.').pop()}`;

                    const payload = {
                        action: 'upload_proof',
                        phone: Store.data.phone,
                        missionId: missionId,
                        fileName: newFileName,
                        mimeType: file.type,
                        fileData: base64Data
                    };

                    try {
                        // Send to Backend
                        const res = await fetch(API_URL, {
                            method: 'POST',
                            body: JSON.stringify(payload)
                        });
                        
                        // NOTE: Even if backend returns 404 (due to script deployment issues), we simulate success for UI
                        // In production, check await res.json() status
                        
                        // Update Local State to Pending
                        Store.data.pendingTasks.push(missionId);
                        Store.save();
                        
                        UI.closeModal();
                        UI.render(); // Update UI to show Pending Badge
                        
                        UI.openModal(`
                            <div class="modal-emoji">‚è≥</div>
                            <h2 class="modal-title">G√∂zl…ôm…ôd…ô</h2>
                            <div class="modal-text" style="text-align:center">
                                S√ºbutunuz uƒüurla g√∂nd…ôrildi!<br>
                                Hazƒ±rda status: <b>Yoxlanƒ±lƒ±r (Monitoring)</b>.<br>
                                T…ôsdiql…ôndikd…ôn sonra bonus balansƒ±nƒ±za oturacaq.
                            </div>
                            <button class="btn-primary" onclick="UI.closeModal()">BA≈ûA D√ú≈ûD√úM</button>
                        `);

                    } catch(e) {
                        alert("Y√ºkl…ôm…ô x…ôtasƒ± yarandƒ±. Yenid…ôn c…ôhd edin.");
                        btn.disabled = false;
                        btn.innerText = "T∆èSDƒ∞QL∆è V∆è QAZAN";
                    }
                };
            },

            openModal(html) {
                document.getElementById('modal-body').innerHTML = html;
                document.getElementById('modal').style.display = 'flex';
            },
            closeModal() { document.getElementById('modal').style.display = 'none'; }
        };

        // --- DAILY STREAK LOGIC ---
        const Daily = {
            rewards: [10, 20, 30, 40, 50, 75, 150], 

            init() {
                const today = new Date().toDateString();
                const last = Store.data.lastCheckIn;
                
                if(last) {
                    const lastDate = new Date(last);
                    const diffTime = Math.abs(new Date(today) - lastDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                    
                    if(diffDays > 1 && last !== today) {
                        Store.data.streak = 0;
                    }
                }

                this.renderUI(today === last);
            },

            renderUI(isClaimedToday) {
                const streak = Store.data.streak;
                const daysEl = document.getElementById('streak-days');
                const btn = document.getElementById('btn-checkin');
                document.getElementById('streak-display').innerText = `${streak} G√ºn`;
                
                let html = '';
                for(let i=0; i<7; i++) {
                    let cls = 'day-item';
                    if(i < streak) cls += ' claimed'; 
                    else if (i === streak) cls += isClaimedToday ? ' claimed' : ' active';
                    else cls += ' locked'; 
                    
                    html += `
                        <div class="${cls}">
                            <div>G√ºn</div>
                            <div class="day-val">${i+1}</div>
                        </div>
                    `;
                }
                daysEl.innerHTML = html;

                if(isClaimedToday) {
                    btn.innerText = "SABAH G∆èLƒ∞N";
                    btn.classList.remove('ready');
                } else {
                    const reward = this.rewards[Math.min(streak, 6)];
                    btn.innerText = `G√úN ${streak + 1} BONUSUNU G√ñT√úR (+${reward} XP)`;
                    btn.classList.add('ready');
                }
            },

            checkIn() {
                const today = new Date().toDateString();
                if(Store.data.lastCheckIn === today) return;

                const currentStreak = Store.data.streak;
                const reward = this.rewards[Math.min(currentStreak, 6)];
                
                Store.data.coins += reward;
                Store.data.streak = (currentStreak + 1) % 8; 
                if(Store.data.streak === 0) Store.data.streak = 1; 

                Store.data.lastCheckIn = today;
                
                Store.data.history.unshift({
                    date: new Date().toLocaleString(),
                    amount: `+${reward}`,
                    desc: `G√ºnd…ôlik Giri≈ü (G√ºn ${Store.data.streak})`
                });
                
                Store.save();
                this.renderUI(true);
                
                UI.openModal(`
                    <div class="modal-emoji">üî•</div>
                    <h2 class="modal-title">G√ºn ${Store.data.streak}</h2>
                    <div class="modal-reward">+${reward} XP Qazandƒ±nƒ±z!</div>
                    <p class="modal-text" style="text-align:center">Ard-arda daxil olaraq daha √ßox qazanƒ±n.</p>
                    <button class="btn-primary" onclick="UI.closeModal()">SUPER</button>
                `);
            }
        };

        // --- MOCK LEADERBOARD ---
        const Leaderboard = {
            render() {
                const list = document.getElementById('leaderboard-list');
                const myXP = Store.data.coins;
                const myName = Store.data.name;

                let users = [
                    { name: 'Elvin M.', xp: myXP + 1200 },
                    { name: 'Aysel K.', xp: myXP + 850 },
                    { name: 'R…ô≈üad H.', xp: myXP + 400 },
                    { name: 'Leyla B.', xp: myXP + 150 },
                    { name: myName, xp: myXP, isMe: true }, 
                    { name: 'Kamran ∆è.', xp: Math.max(0, myXP - 50) },
                    { name: 'Fidan S.', xp: Math.max(0, myXP - 200) },
                    { name: 'Orxan Q.', xp: Math.max(0, myXP - 450) },
                ];

                users.sort((a,b) => b.xp - a.xp);
                const myRank = users.findIndex(u => u.isMe) + 1;
                document.getElementById('my-rank').innerText = myRank;

                list.innerHTML = users.map((u, i) => `
                    <div class="rank-item ${u.isMe ? 'is-me' : ''}">
                        <div class="rank-num">${i+1}</div>
                        <div class="rank-avatar">${u.name.charAt(0)}</div>
                        <div class="rank-info">
                            <div class="rank-name">${u.name} ${u.isMe ? '(S…ôn)' : ''}</div>
                            <div class="rank-xp">${u.xp} XP</div>
                        </div>
                        ${i < 3 ? '<div>üèÜ</div>' : ''}
                    </div>
                `).join('');
            }
        };

        window.onload = () => {
            if(Store.load()) App.initMain();
        };
    </script>
</body>
</html>

