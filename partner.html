<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Brendimo Partner</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/* --- 1. RESET & BASE STYLES --- */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: "Inter", sans-serif; -webkit-tap-highlight-color: transparent; }
body { background: #f8f9fa; color: #1d1d1f; overflow-x: hidden; min-height: 100vh; padding-bottom: 90px; }

/* --- 2. HEADER --- */
.partner-header {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(12px);
    padding: 15px 20px;
    position: sticky; top: 0; z-index: 100;
    border-bottom: 1px solid #eee;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.03);
}
.logo { font-size: 22px; font-weight: 800; color: #c21a1a; letter-spacing: -0.5px; }
.store-badge { 
    font-size: 11px; background: #FFD700; color: #000; 
    padding: 6px 12px; border-radius: 20px; font-weight: 700; 
    text-transform: uppercase; letter-spacing: 0.5px; display: none; 
    box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
}

/* --- 3. LAYOUT SECTIONS (Hidden by default) --- */
#login-section, #shop-container, #builder-controls, #intro-text { display: none; }

/* --- 4. LOGIN SCREEN --- */
.login-wrapper {
    flex-direction: column; align-items: center; justify-content: center;
    height: 85vh; padding: 25px; text-align: center;
}
.login-card {
    background: white; padding: 40px 30px; border-radius: 28px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.08); width: 100%; max-width: 420px;
    transition: transform 0.3s ease;
    border: 1px solid #fff;
}
.input-field {
    width: 100%; padding: 18px; border: 2px solid #f0f0f0; border-radius: 16px;
    font-size: 16px; margin: 25px 0; outline: none; transition: all 0.3s;
    background: #fafafa; color: #333;
}
.input-field:focus { border-color: #c21a1a; background: #fff; box-shadow: 0 0 0 4px rgba(194, 26, 26, 0.1); }
.btn-primary {
    width: 100%; padding: 18px; background: #c21a1a; color: white;
    border: none; border-radius: 16px; font-size: 16px; font-weight: 700;
    cursor: pointer; box-shadow: 0 8px 25px rgba(194, 26, 26, 0.25);
    transition: transform 0.2s, box-shadow 0.2s;
}
.btn-primary:active { transform: scale(0.97); box-shadow: 0 4px 15px rgba(194, 26, 26, 0.2); }

/* --- 5. PROFESSIONAL PRODUCT GRID --- */
.grid-container {
    display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; 
    padding: 16px; max-width: 900px; margin: 0 auto;
}
@media (min-width: 600px) { .grid-container { grid-template-columns: repeat(3, 1fr); } }

/* --- 6. PRODUCT CARD --- */
.product-card {
    background: white; border-radius: 20px; overflow: hidden;
    box-shadow: 0 10px 30px -10px rgba(0,0,0,0.06);
    position: relative; transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1);
    display: flex; flex-direction: column;
    height: 100%;
    border: 1px solid rgba(0,0,0,0.02);
    cursor: pointer;
}
.product-card:active { transform: scale(0.98); }

.card-img-wrapper {
    position: relative; width: 100%; padding-top: 100%; /* 1:1 Square */
    background: #f4f4f4; overflow: hidden;
}
.card-img-wrapper img {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    object-fit: cover; transition: transform 0.5s ease;
}
.card-content { padding: 14px; flex: 1; display: flex; flex-direction: column; }
.card-title { 
    font-size: 14px; font-weight: 700; color: #1a1a1a; margin-bottom: 6px;
    line-height: 1.35;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
}
.card-desc {
    font-size: 11px; color: #888; line-height: 1.4; margin-bottom: 12px;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    flex-grow: 1; 
}
.card-footer { 
    display: flex; align-items: center; justify-content: space-between; 
    margin-top: auto; padding-top: 10px; border-top: 1px solid #f5f5f5;
}
.card-price { color: #c21a1a; font-weight: 800; font-size: 15px; }

/* Small Button on Grid (Customer View) */
.view-btn {
    background: #eee; color: #333; border: none; padding: 6px 12px;
    border-radius: 8px; font-weight: 600; font-size: 11px;
}

/* --- 7. SELECTION MODE (Builder) --- */
.select-check {
    position: absolute; top: 10px; right: 10px;
    width: 28px; height: 28px; border-radius: 50%;
    background: rgba(255,255,255,0.95); border: 2px solid #ddd;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; color: transparent; z-index: 10;
    transition: all 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.product-card.selected { border: 2px solid #c21a1a; }
.product-card.selected .select-check { background: #c21a1a; border-color: #c21a1a; color: white; transform: scale(1.1); }

/* --- 8. DASHBOARD BAR --- */
.dashboard-controls {
    position: fixed; bottom: 0; left: 0; width: 100%;
    background: white; padding: 20px;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.08);
    z-index: 200; display: none; flex-direction: column; gap: 12px;
    border-top-left-radius: 24px; border-top-right-radius: 24px;
}
.selected-count { text-align: center; color: #666; font-size: 13px; font-weight: 500; }

/* --- 9. INTRO TEXT --- */
.intro-text { padding: 30px 20px 10px 20px; text-align: center; }
.intro-text h1 { font-size: 26px; margin-bottom: 8px; color: #111; letter-spacing: -0.5px; }
.intro-text p { color: #666; font-size: 14px; line-height: 1.5; }

/* --- 10. PRODUCT DETAIL MODAL (NEW) --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.7); z-index: 1000; display: none;
    align-items: center; justify-content: center; backdrop-filter: blur(5px);
    opacity: 0; transition: opacity 0.3s;
}
.modal-overlay.active { opacity: 1; }

.product-modal-card {
    background: white; width: 100%; max-width: 400px; height: 90vh; max-height: 600px;
    border-radius: 24px; overflow-y: auto; display: flex; flex-direction: column;
    position: relative; transform: translateY(20px); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
    margin: 20px;
}
.modal-overlay.active .product-modal-card { transform: translateY(0); }

.modal-close-btn {
    position: absolute; top: 15px; right: 15px; z-index: 10;
    background: rgba(0,0,0,0.5); color: white; border-radius: 50%;
    width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 14px; backdrop-filter: blur(4px);
}

.modal-img {
    width: 100%; height: 350px; object-fit: cover; background: #f0f0f0;
}

.modal-content {
    padding: 24px; flex: 1; display: flex; flex-direction: column;
}

.modal-title { font-size: 20px; font-weight: 800; color: #111; margin-bottom: 8px; line-height: 1.3; }
.modal-price { font-size: 24px; font-weight: 800; color: #c21a1a; margin-bottom: 16px; }

.modal-desc-box {
    background: #f9f9f9; padding: 15px; border-radius: 12px; margin-bottom: 20px;
    font-size: 14px; color: #555; line-height: 1.6; border: 1px solid #eee;
}

.modal-buy-btn {
    width: 100%; padding: 16px; background: #25D366; color: white;
    border: none; border-radius: 16px; font-size: 16px; font-weight: 700;
    cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
    margin-top: auto; box-shadow: 0 8px 20px rgba(37, 211, 102, 0.3);
    transition: transform 0.2s;
}
.modal-buy-btn:active { transform: scale(0.96); }

/* --- 11. LINK SHARE MODAL --- */
.share-card {
    background: white; width: 85%; max-width: 360px; padding: 30px;
    border-radius: 28px; text-align: center;
}
.link-box {
    background: #f8f9fa; padding: 15px; border-radius: 12px;
    font-family: monospace; font-size: 13px; color: #333;
    word-break: break-all; margin: 20px 0; border: 1px solid #eee;
    text-align: left;
}

/* --- 12. SKELETON LOADER --- */
.skeleton-card {
    background: white; border-radius: 20px; overflow: hidden; height: 300px;
    display: flex; flex-direction: column;
}
.sk-img { width: 100%; padding-top: 100%; background: #eee; animation: pulse 1.5s infinite; }
.sk-line { height: 12px; background: #eee; margin: 10px 14px; border-radius: 6px; animation: pulse 1.5s infinite; width: 80%; }
.sk-line.short { width: 40%; }
@keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

</style>
</head>
<body>

<div class="partner-header">
    <div class="logo">üéÅ Brendimo</div>
    <div id="store-badge" class="store-badge">R∆èSMƒ∞ PARTNYOR</div>
</div>

<div id="skeleton-grid" class="grid-container" style="display: none; margin-top: 20px;">
    </div>

<div id="login-section" class="login-wrapper">
    <div class="login-card">
        <div style="font-size: 54px; margin-bottom: 15px;">ü§ù</div>
        <h2 style="font-size: 24px; margin-bottom: 8px;">Partnyor Giri≈üi</h2>
        <p style="color: #888; font-size: 14px; line-height: 1.5;">Maƒüazanƒ±zƒ± yaradƒ±n, linkinizi payla≈üƒ±n v…ô satƒ±≈üdan qazanmaƒüa ba≈ülayƒ±n.</p>
        
        <input type="text" id="affiliate-id" class="input-field" placeholder="Partnyor ID (m…ôs: elvin01)">
        <button onclick="handleLogin()" class="btn-primary">Daxil Ol</button>
        <p id="error-msg" style="color: #ff4d4d; font-size: 13px; margin-top: 15px; display: none;"></p>
    </div>
</div>

<div id="shop-container">
    <div class="intro-text" id="intro-text">
        <h1 id="page-title">Y√ºkl…ônir...</h1>
        <p id="page-subtitle">Sizin √º√ß√ºn se√ßilmi≈ü √∂z…ôl h…ôdiyy…ôl…ôr ‚ú®</p>
    </div>

    <div class="grid-container" id="product-grid"></div>
</div>

<div id="builder-controls" class="dashboard-controls">
    <div class="selected-count" id="sel-count">0 m…ôhsul se√ßilib</div>
    <button onclick="generateLink()" class="btn-primary">üîó Maƒüaza Linkini Yarat</button>
</div>

<div id="product-modal" class="modal-overlay">
    <div class="product-modal-card">
        <div class="modal-close-btn" onclick="closeProductModal()">‚úï</div>
        <img src="" id="pm-img" class="modal-img">
        <div class="modal-content">
            <h2 id="pm-title" class="modal-title">Product Name</h2>
            <div id="pm-price" class="modal-price">0.00 AZN</div>
            <div class="modal-desc-box">
                <p id="pm-desc">Description goes here...</p>
            </div>
            <button id="pm-buy-btn" class="modal-buy-btn">
                <svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                WhatsApp il…ô Sifari≈ü Et
            </button>
        </div>
    </div>
</div>

<div id="share-modal" class="modal-overlay">
    <div class="share-card">
        <div style="font-size: 40px; margin-bottom: 10px;">üéâ</div>
        <h3 style="font-size: 20px;">Link Hazƒ±rdƒ±r!</h3>
        <p style="font-size: 13px; color: #888; margin-top: 8px;">Bu linki m√º≈üt…ôril…ôriniz…ô g√∂nd…ôrin.</p>
        <div class="link-box" id="final-link">...</div>
        <button onclick="copyLink()" class="btn-primary" style="margin-bottom: 12px;">Kopyala</button>
        <button onclick="closeShareModal()" style="background: transparent; border: none; color: #888; font-weight: 600; cursor: pointer;">Baƒüla</button>
    </div>
</div>

<script>
// --- CONFIGURATION ---
const SHEETS_ENDPOINT = "https://script.google.com/macros/s/AKfycbze1YWZVrxz-4EDvB8_lcxDYB-7hqP9XzyN2_kU6wVoEfmMa1erSJvSgGGZIhjQNq04bA/exec"; 

// --- STATE ---
let allProducts = [];
let selectedProducts = new Set();
let affiliateData = null; 
let isBuilderMode = false;

// --- INITIALIZATION ---
window.onload = function() {
    renderSkeletonLoader();
    
    const urlParams = new URLSearchParams(window.location.search);
    const affId = urlParams.get('ref');
    const items = urlParams.get('items');

    if (affId) {
        // Customer Mode
        document.getElementById('login-section').style.display = 'none';
        initCustomerMode(affId, items);
    } else {
        // Partner Mode
        document.getElementById('skeleton-grid').style.display = 'none';
        document.getElementById('login-section').style.display = 'flex';
    }
};

// --- CORE FUNCTIONS ---

async function initCustomerMode(affId, itemsEncoded) {
    loadProductsFromCache();

    try {
        const [affRes, prodRes] = await Promise.all([
            fetch(`${SHEETS_ENDPOINT}?action=getAffiliateData&id=${affId}`),
            fetch(`${SHEETS_ENDPOINT}?action=getProducts`) 
        ]);

        const affData = await affRes.json();
        const prodData = await prodRes.json();

        if (affData.success) {
            affiliateData = affData;
            setupShopUI(affData);
        } else {
            document.body.innerHTML = "<h2 style='text-align:center; margin-top:50px;'>Maƒüaza tapƒ±lmadƒ±.</h2>";
            return;
        }

        if (prodData.products) {
            allProducts = prodData.products;
            saveProductsToCache(allProducts);
            
            if (itemsEncoded) {
                const indexes = itemsEncoded.split(',').map(n => parseInt(n));
                const filtered = allProducts.filter((_, i) => indexes.includes(i));
                if(filtered.length > 0) allProducts = filtered;
            }
            renderGrid();
        }
    } catch (e) {
        if(allProducts.length === 0) showError("ƒ∞nternet baƒülantƒ±sƒ±nƒ± yoxlayƒ±n.");
    }

    document.getElementById('skeleton-grid').style.display = 'none';
    document.getElementById('shop-container').style.display = 'block';
    document.getElementById('intro-text').style.display = 'block';
}

async function handleLogin() {
    const id = document.getElementById('affiliate-id').value.trim();
    if(!id) { alert("ID daxil edin"); return; }
    
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('skeleton-grid').style.display = 'grid';

    try {
        const [affRes, prodRes] = await Promise.all([
            fetch(`${SHEETS_ENDPOINT}?action=getAffiliateData&id=${id}`),
            fetch(`${SHEETS_ENDPOINT}?action=getProducts`)
        ]);

        const affData = await affRes.json();
        const prodData = await prodRes.json();

        if (affData.success) {
            affiliateData = affData;
            isBuilderMode = true;
            
            allProducts = prodData.products || [];
            saveProductsToCache(allProducts);

            setupShopUI(affData);
            
            document.getElementById('skeleton-grid').style.display = 'none';
            document.getElementById('shop-container').style.display = 'block';
            document.getElementById('builder-controls').style.display = 'flex';
            document.getElementById('intro-text').style.display = 'block';
            document.getElementById('product-grid').style.display = 'grid';
            document.getElementById('page-subtitle').textContent = "Satmaq ist…ôdiyiniz m…ôhsullarƒ± se√ßin.";

            renderGrid();
        } else {
            document.getElementById('skeleton-grid').style.display = 'none';
            document.getElementById('login-section').style.display = 'flex';
            showError("Partnyor ID tapƒ±lmadƒ±.");
        }

    } catch (e) {
        document.getElementById('skeleton-grid').style.display = 'none';
        document.getElementById('login-section').style.display = 'flex';
        showError("X…ôta ba≈ü verdi. ƒ∞nterneti yoxlayƒ±n.");
    }
}

// --- UI HELPERS ---

function setupShopUI(data) {
    document.title = data.storeName;
    document.getElementById('page-title').textContent = isBuilderMode ? `Salam, ${data.storeName} üëã` : data.storeName;
    document.querySelector('.logo').textContent = "üéÅ " + data.storeName;
    document.querySelector('.store-badge').style.display = 'block';
}

function renderGrid() {
    const container = document.getElementById('product-grid');
    container.innerHTML = '';

    allProducts.forEach((p, index) => {
        const el = document.createElement('div');
        let imgUrl = fixImageLink(p.image);
        let desc = p.description || "H…ôdiyy…ôlik m…ôhsul";

        // Logic split
        let actionContent = '';
        let selectHtml = '';
        
        if (isBuilderMode) {
            // BUILDER: Selection
            selectHtml = `<div class="select-check">‚úî</div>`;
            actionContent = `<span style="font-size:11px; color:#888;">Se√ßm…ôk √º√ß√ºn toxunun</span>`;
            el.onclick = () => toggleSelection(index, el.querySelector('.product-card'));
        } else {
            // CUSTOMER: View Details
            actionContent = `<span class="view-btn">∆ètraflƒ± Bax ‚Üí</span>`;
            el.onclick = () => openProductModal(p); // Opens the new modal
        }

        el.innerHTML = `
            <article class="product-card">
                ${selectHtml}
                <div class="card-img-wrapper">
                    <img src="${imgUrl}" loading="lazy" alt="${p.name}">
                </div>
                <div class="card-content">
                    <h3 class="card-title">${p.name}</h3>
                    <p class="card-desc">${desc}</p>
                    <div class="card-footer">
                        <span class="card-price">${p.price} ‚Çº</span>
                        ${actionContent}
                    </div>
                </div>
            </article>
        `;
        container.appendChild(el);
    });
}

// --- PRODUCT DETAIL MODAL LOGIC ---

function openProductModal(product) {
    const modal = document.getElementById('product-modal');
    const imgUrl = fixImageLink(product.image);
    
    // Fill Data
    document.getElementById('pm-img').src = imgUrl;
    document.getElementById('pm-title').textContent = product.name;
    document.getElementById('pm-price').textContent = `${product.price} AZN`;
    document.getElementById('pm-desc').textContent = product.description || "∆ètraflƒ± m…ôlumat yoxdur.";
    
    // Attach Buy Event
    const buyBtn = document.getElementById('pm-buy-btn');
    buyBtn.onclick = () => buyItem(product.name, product.price, imgUrl);

    // Show Modal
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden'; // Stop background scrolling
    setTimeout(() => modal.classList.add('active'), 10);
}

function closeProductModal() {
    const modal = document.getElementById('product-modal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto'; // Resume scrolling
    setTimeout(() => modal.style.display = 'none', 300);
}

function buyItem(prodName, price, imgUrl) {
    const phone = affiliateData.phone;
    
    // --- UPDATED WHATSAPP MESSAGE LOGIC ---
    const text = `Salam ${affiliateData.storeName}! üëã\n\n` +
                 `M…ôn bu m…ôhsulu sifari≈ü etm…ôk ist…ôyir…ôm:\n` +
                 `üõç *${prodName}*\n` +
                 `üí∞ Qiym…ôt: ${price} AZN\n\n` +
                 `üì∏ ≈û…ôkil: ${imgUrl}\n\n` +
                 `‚ùì *Z…ôhm…ôt olmasa qeyd ed…ôrdiniz, √ßatdƒ±rƒ±lma ne√ß…ôy…ôdir?*`; 

    const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank');
}

// --- BUILDER ACTIONS ---

function toggleSelection(index, cardEl) {
    if (selectedProducts.has(index)) {
        selectedProducts.delete(index);
        cardEl.classList.remove('selected');
    } else {
        selectedProducts.add(index);
        cardEl.classList.add('selected');
    }
    document.getElementById('sel-count').textContent = `${selectedProducts.size} m…ôhsul se√ßilib`;
}

function generateLink() {
    if(selectedProducts.size === 0) { alert("∆èn azƒ± 1 m…ôhsul se√ßin!"); return; }
    const indexes = Array.from(selectedProducts).sort((a,b)=>a-b).join(',');
    const origin = window.location.origin;
    const pathname = window.location.pathname;
    const finalUrl = `${origin}${pathname}?ref=${affiliateData.id}&items=${indexes}`;
    
    document.getElementById('final-link').textContent = finalUrl;
    const modal = document.getElementById('share-modal');
    modal.style.display = 'flex';
    setTimeout(() => modal.classList.add('active'), 10);
}

function copyLink() {
    navigator.clipboard.writeText(document.getElementById('final-link').textContent)
        .then(() => alert("Link kopyalandƒ±!"))
        .catch(() => alert("∆èll…ô kopyalayƒ±n."));
}

function closeShareModal() {
    const modal = document.getElementById('share-modal');
    modal.classList.remove('active');
    setTimeout(() => modal.style.display = 'none', 300);
}

// --- UTILS ---

function loadProductsFromCache() {
    const cached = localStorage.getItem('brendimo_products');
    const time = localStorage.getItem('brendimo_cache_time');
    if (cached && time && (Date.now() - time < 1800000)) {
        allProducts = JSON.parse(cached);
        document.getElementById('skeleton-grid').style.display = 'none';
        document.getElementById('shop-container').style.display = 'block';
        document.getElementById('intro-text').style.display = 'block';
        document.getElementById('product-grid').style.display = 'grid'; 
        renderGrid();
    }
}

function saveProductsToCache(products) {
    if(products.length > 0) {
        localStorage.setItem('brendimo_products', JSON.stringify(products));
        localStorage.setItem('brendimo_cache_time', Date.now());
    }
}

function renderSkeletonLoader() {
    const skContainer = document.getElementById('skeleton-grid');
    skContainer.style.display = 'grid';
    skContainer.innerHTML = '';
    for(let i=0; i<6; i++) {
        skContainer.innerHTML += `<div class="skeleton-card"><div class="sk-img"></div><div class="sk-line"></div><div class="sk-line short"></div></div>`;
    }
}

function fixImageLink(url) {
    if (!url) return 'https://via.placeholder.com/300?text=No+Image';
    if (url.includes('drive.google.com')) { const idMatch = url.match(/[-\w]{25,}/); if (idMatch) return `https://googleusercontent.com/profile/picture/0${idMatch[0]}`; }
    return url;
}

function showError(msg) {
    const el = document.getElementById('error-msg');
    el.textContent = msg; el.style.display = 'block';
}
</script>
</body>
</html>
